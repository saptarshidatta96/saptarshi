<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Deployment on Azure Container Registry &amp; Azure Kubernetes Service | Saptarshi Datta</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Deployment on Azure Container Registry &amp; Azure Kubernetes Service" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In the previous post, we wrapped out ML Model inside a Flask Web Service which we could access through GET and POST Requests. Once, we found the application running perfectly on out local system, we containerised the application and pushed it to docker hub." />
<meta property="og:description" content="In the previous post, we wrapped out ML Model inside a Flask Web Service which we could access through GET and POST Requests. Once, we found the application running perfectly on out local system, we containerised the application and pushed it to docker hub." />
<link rel="canonical" href="https://saptarshidatta.in/2022/01/08/Deployment-on-Azure-Container-Registry-&-Azure-Kubernetes-Service.html" />
<meta property="og:url" content="https://saptarshidatta.in/2022/01/08/Deployment-on-Azure-Container-Registry-&-Azure-Kubernetes-Service.html" />
<meta property="og:site_name" content="Saptarshi Datta" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-01-08T00:00:00-06:00" />
<script type="application/ld+json">
{"dateModified":"2022-01-08T00:00:00-06:00","datePublished":"2022-01-08T00:00:00-06:00","url":"https://saptarshidatta.in/2022/01/08/Deployment-on-Azure-Container-Registry-&-Azure-Kubernetes-Service.html","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://saptarshidatta.in/2022/01/08/Deployment-on-Azure-Container-Registry-&-Azure-Kubernetes-Service.html"},"headline":"Deployment on Azure Container Registry &amp; Azure Kubernetes Service","description":"In the previous post, we wrapped out ML Model inside a Flask Web Service which we could access through GET and POST Requests. Once, we found the application running perfectly on out local system, we containerised the application and pushed it to docker hub.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://saptarshidatta.in/feed.xml" title="Saptarshi Datta" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link href="https://cdn.jsdelivr.net/npm/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.css">

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Saptarshi Datta</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/kb/">Knowledge Base</a><a class="page-link" href="/projects/">Projects</a><a class="page-link" href="/cv/">Curriculum Vitae</a><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Deployment on Azure Container Registry &amp; Azure Kubernetes Service</h1><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-01-08T00:00:00-06:00" itemprop="datePublished">
        Jan 8, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>In the previous <a href="https://saptarshidatta.in/2021/12/14/serving-machine-learning-model-with-api.html">post</a>, we wrapped out ML Model inside a Flask Web Service which we could access through GET and POST Requests. Once, we found the application running perfectly on out local system, we  containerised the application and pushed it to <a href="https://hub.docker.com/r/saptarshidatta96/breast_cancer">docker hub</a>.</p>

<p>Today, we’re going to take it up a notch further and will deploy the service on Azure Cloud Service.
We can perform the task in two ways:</p>

<ol>
  <li>
    <p>Running out application as a Container Instance in Azure Container Registry(ACR)</p>
  </li>
  <li>
    <p>Deploying the Application on Azure Kubernetes Service(AKS)</p>
  </li>
</ol>

<p>At first, we will create a resource group and will then create an Azure Container Registry within that resource group. Every Azure Service that we are going to create will be inside our Resource Group. We have named our resource group as <code class="language-plaintext highlighter-rouge">trial-rg</code>. The name of the Azure Container Registry is <code class="language-plaintext highlighter-rouge">breastcancersd</code>.</p>

<p>##<em><strong>Running the Application as a Container Instance in Azure Container Registry(ACR)</strong></em></p>

<p>We will be using Azure CLI for running the commands.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#Create A Resource Group
az group create --name trial-rg --location centralindia

#Get Subscription
az account show --output table

#Create ACR
az acr create  --resource-group trial-rg  --name breastcancersd --sku Basic
</code></pre></div></div>
<p>Once we have completed completed the above steps, we should check whether the resources have been created properly in the Azure Portal. Next, we will login to the Container registry, tag the local docker image to that of the container Registry, and then push it to the container registry.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#Login to ACR
az acr login -n breastcancersd

#Tag a Docker Image to ACR
docker tag breast_cancer:latest breastcancersd.azurecr.io/breast_cancer:v1.0

#Push the image to ACR
docker push breastcancersd.azurecr.io/breast_cancer:v1.0
</code></pre></div></div>
<p>Once done, we should verify that the image is present in the Container Registry. Next, we</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#Enable Admin Credentials on the ACR
az acr update -n breastcancersd --admin-enabled true

#Run the Azure Container Instance
az container create --resource-group trial-rg --name breast-cancer --image breastcancersd.azurecr.io/breast_cancer:latest --cpu 1 --memory 1 --registry-login-server breastcancersd.azurecr.io --registry-username breastcancersd --registry-password &lt;acr_password&gt; --dns-name-label breastcancerapp --ports 12345

az container show --resource-group trial-rg --name breast-cancer --query instanceView.state

az container show --resource-group trial-rg --name breast-cancer --query ipAddress.fqdn

#View Logs
az container logs --resource-group trial-rg --name breast-cancer
</code></pre></div></div>
<p>Once the container instance is running, we can run the below access the service below</p>

<p><img src="/images/ACR.PNG" alt="" /></p>

<p>Hence we have deployed and run the application as a Container Instance on Azure Container Registry. Once, the application have been tested, make sure to run the below command to delete the resource group to prevent Recurring Charges.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>az group delete --name trial-rg
</code></pre></div></div>

<p>##<em><strong>Deploying the Application on Azure Kubernetes Service(AKS)</strong></em></p>

<p>In this process, we will be following the same steps from creating a resource group till pushing the docker image on ACR, but after than, we will need to create a Deployment File, that will Deploy the Application on a Kubernetes Cluster.</p>

<p>The basic, initial steps will be:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#Create A Resource Group
az group create --name trial-rg --location centralindia

#Get Subscription
az account show --output table

#Create ACR
az acr create  --resource-group trial-rg  --name breastcancersd --sku Basic

#Login to ACR
az acr login -n breastcancersd

#Tag a Docker Image to ACR
docker tag breast_cancer:latest breastcancersd.azurecr.io/breast_cancer:v1.0

#Push the image to ACR
docker push breastcancersd.azurecr.io/breast_cancer:v1.0
</code></pre></div></div>

  </div><a class="u-url" href="/2022/01/08/Deployment-on-Azure-Container-Registry-&-Azure-Kubernetes-Service.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Deep Learning, Computer Vision &amp; more.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/saptarshidatta96" target="_blank" title="saptarshidatta96"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/ds_saptarshi" target="_blank" title="ds_saptarshi"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
